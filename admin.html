<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body { font-family: Arial; padding:20px; max-width:800px; margin:auto; }
.card {
  border:1px solid #ccc;
  padding:10px;
  margin-bottom:10px;
}
.pending { background:#FF9800; color:white; }
.confirmed { background:#f44336; color:white; }
button { margin:5px; padding:5px 10px; }
</style>
</head>
<body>

<h2>Admin Panel</h2>
<div id="list"></div>

<script>
const { createClient } = supabase;
const supabaseClient = createClient(
  "https://cfjagwpyfldoqwqnrnpg.supabase.co",
  "sb_publishable_5l9E1gSb_0hwx0_ZnFuITQ_AheUZpv7"
);

async function loadReservations() {
  const { data } = await supabaseClient
    .from("reservations")
    .select("*")
    .order("created_at", { ascending: false });

  const list = document.getElementById("list");
  list.innerHTML = "";

  data.forEach(r => {
    const div = document.createElement("div");
    div.className = "card " + r.status;
    div.innerHTML = `
      <strong>${r.name}</strong><br>
      ${r.type}<br>
      ${r.days.join(", ")}<br>
      ${r.details}<br>
      <button onclick="confirmReservation('${r.id}')">Confirm</button>
    `;
    list.appendChild(div);
  });
}

async function confirmReservation(id) {
  await supabaseClient
    .from("reservations")
    .update({ status: "confirmed" })
    .eq("id", id);

  loadReservations();
}

loadReservations();

supabaseClient
  .channel('realtime')
  .on('postgres_changes', 
      { event: '*', schema: 'public', table: 'reservations' },
      () => loadReservations()
  )
  .subscribe();
</script>

</body>
</html>
